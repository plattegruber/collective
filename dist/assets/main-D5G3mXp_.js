const l=window.THREE;async function x(t){const n=new l.Group,{w:e,h:s,z:r}=t.overlay.panel,f=new l.PlaneGeometry(e,s),i=new l.MeshBasicMaterial({color:1118481,opacity:.8,transparent:!0}),o=new l.Mesh(f,i);o.position.set(0,-s*.65,r),n.add(o);const p=await u(t),d=new l.PlaneGeometry(e*.96,s*.96),c=new l.MeshBasicMaterial({map:p,transparent:!0}),a=new l.Mesh(d,c);return a.position.copy(o.position),a.position.z+=.001,n.add(a),n}async function u(t){const n=document.createElement("canvas");n.width=1024,n.height=512;const e=n.getContext("2d");e.clearRect(0,0,n.width,n.height),e.fillStyle="#FFFFFF",e.textAlign="left",e.textBaseline="top",e.font="bold 64px system-ui, Arial, sans-serif",e.fillText(t.title||"",40,60),e.font="36px system-ui, Arial, sans-serif";const s=`${t.artist||""}${t.year?", "+t.year:""}`;if(e.fillText(s,40,150),e.font="28px system-ui, Arial, sans-serif",e.fillText(t.materials||"",40,210),t.description&&t.description!=="â€”"){e.font="24px system-ui, Arial, sans-serif",e.fillStyle="#CCCCCC";const f=t.description.split(" ");let i="",o=270;const p=900,d=32;for(const c of f){const a=i+c+" ";if(e.measureText(a).width>p&&i!==""){if(e.fillText(i,40,o),i=c+" ",o+=d,o>450)break}else i=a}i&&o<=450&&e.fillText(i,40,o)}const r=new l.CanvasTexture(n);return r.needsUpdate=!0,r}const g=window.THREE,{MindARThree:y}=window;async function h({map:t,content:n,versions:e}){const s=new y({container:document.body,imageTargetSrc:`/targets/${e.mindFile}`,maxTrack:e.maxTrack}),{renderer:r,scene:f,camera:i}=s,o=new g.HemisphereLight(16777215,4473924,1);f.add(o);for(const{index:p,artId:d}of t.targets){const c=s.addAnchor(p),a=await x(n[d]);a.visible=!1,c.group.add(a),c.onTargetFound=()=>{console.log(`Target found: ${d}`),w(a,!0)},c.onTargetLost=()=>{console.log(`Target lost: ${d}`),w(a,!1)}}window.addEventListener("resize",()=>{r.setSize(window.innerWidth,window.innerHeight),i.aspect=window.innerWidth/window.innerHeight,i.updateProjectionMatrix()}),await s.start(),console.log("MindAR started successfully"),r.setAnimationLoop(()=>{r.render(f,i)})}function w(t,n){t.visible=n,n&&t.traverse(e=>{e.material&&e.material.opacity!==void 0&&(e.material.opacity=1)})}const m={targetsMap:"v1",artContent:"v1",mindFile:"gallery-v1.mind",maxTrack:2};(async()=>{try{const[t,n]=await Promise.all([fetch(`/targets/targets-map.${m.targetsMap}.json`).then(e=>e.json()),fetch(`/data/art-content.${m.artContent}.json`).then(e=>e.json())]);await h({map:t,content:n,versions:m}),document.getElementById("loading").style.display="none"}catch(t){console.error("Failed to initialize AR tracker:",t),document.getElementById("loading").textContent="Failed to load. Please refresh."}})();export{m as VERSIONS};
